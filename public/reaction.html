<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>üéØ Focus Flick</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', sans-serif;
      background: #62498ad8;
      color: #f3eaff;
      text-align: center;
    }

    .container {
      min-height: 100vh;
      padding: 20px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
    }

    h1 {
      font-size: clamp(1.5rem, 4vw, 2rem);
      color: #e8d9ff;
      margin-bottom: 10px;
      text-shadow: 1px 2px 0px #3f1262;
    }

    .game-area {
  background: #77609a;
  width: clamp(220px, 50vw, 320px);
  height: clamp(400px, 70vh, 600px);
  border-radius: 20px;
  box-shadow: 0px 8px 16px #2d1b48;
  position: relative;
  overflow: hidden;
  margin-top: 20px;
  border: 2px solid #d5c1f2;
}

.circle {
  width: clamp(40px, 8vw, 60px);   /* bigger on larger screens */
  height: clamp(40px, 8vw, 60px);
  border-radius: 50%;
  background: #ccb5f7;
  position: absolute;
  cursor: pointer;
  transition: transform 0.2s ease;
}


    .menu {
      position: relative;
      margin-top: 20px;
      display: flex;
      gap: 10px;
    }

    .menu button {
      background: #9372c1;
      border: none;
      padding: 8px 16px;
      color: white;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
      transition: background-color 0.3s ease;
    }

    .menu button:hover {
      background: #c39bf0;
    }

    .hearts {
      display: flex;
      justify-content: center;
      gap: 8px;
      margin-top: 12px;
    }

    .heart {
      font-size: 20px;
      color: #ff7aa2;
    }

    .overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(30, 15, 50, 0.95);
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      color: #f0e6fa;
      z-index: 10;
      text-align: center;
      padding: 20px;
    }

    .overlay button {
      margin-top: 20px;
      padding: 12px 24px;
      font-size: 16px;
      background: #aa82de;
      border: none;
      border-radius: 8px;
      color: white;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }

    .overlay button:hover {
      background: #ccb1fa;
    }

    /* Responsive Overlay Text */
    .overlay div {
      font-size: 18px;
      line-height: 1.5;
    }

    @media (max-width: 480px) {
      .overlay div {
        font-size: 15px;
      }

      .overlay button {
        font-size: 14px;
        padding: 10px 20px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üéØ Focus Flick<br><small>Score: <span id="score">0</span> | Level: <span id="level">1</span></small></h1>
    <div class="game-area" id="gameArea"></div>
    <div class="hearts" id="hearts"></div>
    <div class="menu">
      <button onclick="pauseGame()">‚è∏Ô∏è Pause</button>
      <button onclick="restartGame()">üîÑ Restart</button>
      <button onclick="quitGame()">‚ùå Quit</button>
    </div>
  </div>

  <!-- üß† Updated overlay with separate lines -->
  <div class="overlay" id="startScreen">
    <div><strong>How to Play:</strong></div>
    <div>Tap the circles before they vanish!</div>
    <button onclick="startGame()">‚ñ∂ Start Game</button>
  </div>

  <div class="overlay" id="gameOverScreen" style="display:none">
    <div><strong>Game Over!</strong></div>
    <button onclick="restartGame()">üîÅ Restart</button>
  </div>

  <script>
    const gameArea = document.getElementById("gameArea");
    const scoreEl = document.getElementById("score");
    const levelEl = document.getElementById("level");
    const heartsEl = document.getElementById("hearts");
    const startScreen = document.getElementById("startScreen");
    const gameOverScreen = document.getElementById("gameOverScreen");

    let score = 0, level = 1, interval = null, lives = 3, paused = false;

    function updateHUD() {
      scoreEl.textContent = score;
      levelEl.textContent = level;
      heartsEl.innerHTML = "‚ù§Ô∏è".repeat(lives);
    }

    function startGame() {
      score = 0;
      level = 1;
      lives = 3;
      paused = false;
      updateHUD();
      startScreen.style.display = "none";
      spawnLoop();
    }

    function spawnLoop() {
      clearInterval(interval);
      const speed = Math.max(1000 - level * 100, 300);
      interval = setInterval(spawnCircle, speed);
    }

    function spawnCircle() {
      if (paused || lives <= 0) return;
      const circle = document.createElement("div");
      circle.classList.add("circle");

      const gameWidth = gameArea.clientWidth;
      const gameHeight = gameArea.clientHeight;
      const circleSize = 40;

      const maxX = gameWidth - circleSize;
      const maxY = gameHeight - circleSize;

      circle.style.left = `${Math.random() * maxX}px`;
      circle.style.top = `${Math.random() * maxY}px`;

      let clicked = false;
      circle.onclick = () => {
        clicked = true;
        gameArea.removeChild(circle);
        score++;
        if (score % 5 === 0) level++;
        updateHUD();
        spawnLoop();
      };

      gameArea.appendChild(circle);

      setTimeout(() => {
        if (!clicked && gameArea.contains(circle)) {
          gameArea.removeChild(circle);
          lives--;
          updateHUD();
          if (lives <= 0) endGame();
        }
      }, 1500);
    }

    function pauseGame() {
      paused = !paused;
    }

    function restartGame() {
      location.reload();
    }

    function quitGame() {
      saveScoreToServer(score, level, () => {
        window.parent.dispatchEvent(new Event("reactionQuit"));
      });
    }

    function endGame() {
      clearInterval(interval);
      gameOverScreen.style.display = "flex";
      saveScoreToServer(score, level);
    }

    function saveScoreToServer(score, level, callback = () => {}) {
      const email = localStorage.getItem("userEmail");
      if (!email) return;

      fetch("http://localhost:5000/api/score", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          email: email,
          game_name: "Circle Tap",
          score: score,
          level: level
        })
      })
      .then(res => res.json())
      .then(data => {
        if (data.success) {
          console.log("‚úÖ Score saved");
        } else {
          console.error("‚ùå Failed to save score:", data.error);
        }
        callback();
      })
      .catch(err => {
        console.error("Server error:", err);
        callback();
      });
    }
  </script>
</body>
</html>
